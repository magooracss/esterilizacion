SET TERM ^ ;
/* Connect using username: SYSDBA */
/* and server: WI-V6.3.2.26539 Firebird 2.5 */
SET SQL DIALECT 3^
SET AUTODDL ON^
CREATE DATABASE 'c:\folp\esterilizacion\esterilizacion.fdb'
  USER 'SYSDBA' PASSWORD 'masterkey'
  DEFAULT CHARACTER SET UTF8^

CREATE GENERATOR GENNROESTERILIZACION^
SET GENERATOR GENNROESTERILIZACION TO 22^

CREATE GENERATOR GENTIPODOCUMENTO^
SET GENERATOR GENTIPODOCUMENTO TO 3^

COMMIT^

CREATE DOMAIN "guid"
  AS VARCHAR(38)
  CHARACTER SET ASCII
  DEFAULT '{00000000-0000-0000-0000-000000000000}' NOT NULL^

COMMIT^

CREATE TABLE TBALUMNOS (
  IDALUMNO guid NOT NULL,
  CAPELLIDOS VARCHAR(500),
  CNOMBRES VARCHAR(500),
  REFTIPODOC INTEGER DEFAULT 0,
  DOCUMENTO VARCHAR(30),
  NROALUMNO INTEGER,
  TARJETALEGAJO INTEGER,
  TARJETADIGITO INTEGER,
  REFFOTO guid DEFAULT '{00000000-0000-0000-0000-000000000000}',
  TXNOTAS BLOB SUB_TYPE TEXT SEGMENT SIZE 80,
  DIRECCION VARCHAR(1000),
  TELEFONO VARCHAR(100),
  LOCALIDAD VARCHAR(500),
  SUSPENDIDOINI DATE,
  SUSPENDIDOFIN DATE,
  BVISIBLE SMALLINT DEFAULT 1,
  CATEGORIA VARCHAR(2) DEFAULT 'A' )^

CREATE TABLE TBESTERILIZACION (
  IDESTERILIZACION guid NOT NULL,
  NROORDEN INTEGER DEFAULT -1,
  CODBARRA VARCHAR(30) DEFAULT '00000000',
  REFALUMNO guid DEFAULT '{00000000-0000-0000-0000-000000000000}',
  HORAINGRESO TIME,
  FECHAINGRESO DATE,
  PESOINGRESO FLOAT DEFAULT 0.0,
  TXOBSINGRESO BLOB SUB_TYPE TEXT SEGMENT SIZE 80,
  REFRESPINGRESO guid DEFAULT '{00000000-0000-0000-0000-000000000000}',
  HORAEGRESO TIME,
  FECHAEGRESO DATE,
  PESOEGRESO FLOAT DEFAULT 0.0,
  TXOBSEGRESO BLOB SUB_TYPE TEXT SEGMENT SIZE 80,
  REFRESPEGRESO guid DEFAULT '{00000000-0000-0000-0000-000000000000}',
  BVISIBLE SMALLINT DEFAULT 1,
  ULTACCESO TIMESTAMP,
  REFULTACCESO guid DEFAULT '{00000000-0000-0000-0000-000000000000}',
  REFULTREIMPRESION guid DEFAULT '{00000000-0000-0000-0000-000000000000}' )^

CREATE TABLE TBFOTOS (
  IDFOTO guid NOT NULL,
  FOTO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
  RELACION guid DEFAULT '{00000000-0000-0000-0000-000000000000}' )^

CREATE TABLE TBRESPONSABLES (
  IDRESPONSABLE guid NOT NULL,
  CAPELLIDOS VARCHAR(500),
  CNOMBRES VARCHAR(500),
  REFTIPODOC INTEGER DEFAULT 0,
  DOCUMENTO VARCHAR(30),
  LEGAJO INTEGER,
  REFFOTO guid DEFAULT '{00000000-0000-0000-0000-000000000000}',
  TXNOTAS BLOB SUB_TYPE TEXT SEGMENT SIZE 80,
  TARJETALEGAJO INTEGER,
  TARJETADIGITO INTEGER,
  HORARIO1INI TIME,
  HORARIO1FIN TIME,
  HORARIO2INI TIME,
  HORARIO2FIN TIME,
  FRANCODIA INTEGER,
  FRANCOINI TIME,
  FRANCOFIN TIME,
  REFGRUPO INTEGER,
  BVISIBLE SMALLINT DEFAULT 1 )^

CREATE TABLE TBUSUARIOS (
  IDUSUARIO guid NOT NULL,
  USUARIO VARCHAR(50),
  CLAVE VARCHAR(30),
  PAPLICACION VARCHAR(1) DEFAULT 'N',
  PESTMATERIAL VARCHAR(1) DEFAULT 'N',
  PESTHISTORICO VARCHAR(1) DEFAULT 'N',
  PPRESTARTICULOS VARCHAR(1) DEFAULT 'N',
  PSUSPENCIONES VARCHAR(1) DEFAULT 'N',
  PALUMNOS VARCHAR(1) DEFAULT 'N',
  PDOCENTES VARCHAR(1) DEFAULT 'N',
  PARTICULOS VARCHAR(1) DEFAULT 'N',
  PPERSONAL VARCHAR(1) DEFAULT 'N',
  PTARJETAALUMNO VARCHAR(1) DEFAULT 'N',
  PTARJETAARTICULO VARCHAR(1) DEFAULT 'N',
  PTARJETAPERSONAL VARCHAR(1) DEFAULT 'N',
  BVISIBLE SMALLINT DEFAULT 1,
  ULTACCESO TIMESTAMP,
  REFULTACCESO guid DEFAULT '{00000000-0000-0000-0000-000000000000}' )^

CREATE TABLE TUGGRUPOSRESPONSABLES (
  IDGRUPORESPONSABLE INTEGER DEFAULT -1,
  GRUPORESPONSABLE VARCHAR(300) DEFAULT '-',
  BVISIBLE SMALLINT DEFAULT 1 )^

CREATE TABLE TUGTIPOSDOCUMENTO (
  IDTIPODOCUMENTO INTEGER DEFAULT -1,
  TIPODOCUMENTO VARCHAR(300) DEFAULT '-',
  BVISIBLE SMALLINT DEFAULT 1 )^

COMMIT^

CREATE ROLE RDB$ADMIN^

COMMIT^

CREATE TRIGGER IDTBESTERILIZACION FOR TBESTERILIZACION
  BEFORE INSERT
AS
BEGIN 
    If (New.nroOrden = -1) then
   New.nroOrden = GEN_ID(GenNroEsterilizacion,1);
END^

CREATE TRIGGER IDTUGTIPOSDOCUMENTO FOR TUGTIPOSDOCUMENTO
  BEFORE INSERT
AS
BEGIN 
    If (New.idTipoDocumento = -1) then
   New.idTipoDocumento = GEN_ID(GenTipoDocumento,1);
END^

COMMIT^

